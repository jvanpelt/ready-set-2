<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="touch-icon-iphone.png">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Ready, Set 2 - Set Theory Puzzle Game</title>
    <link rel="stylesheet" href="css/styles.css?v=3.0.9">
</head>
<body>
    <div id="app">
        <!-- Game Board -->
        <div id="game-board" class="game-board">
            <div id="cards-container" class="cards-container"></div>
        </div>

        <!-- Dice Area -->
        <div id="dice-area" class="dice-area">
            <div id="dice-container" class="dice-container"></div>
        </div>

        <!-- Solution Area -->
        <div id="solution-area" class="solution-area">
            <div class="solution-row" data-row="0"></div>
            <div class="solution-row" data-row="1"></div>
        </div>

        <!-- Status Bar (redesigned to match old game) -->
        <div class="status-bar">
            <div class="score-display">
                <div class="stat-label">Score:</div>
                <div class="stat-value">
                    <span id="current-score">0</span><span class="stat-divider">/</span><span id="goal-score">750</span>
                </div>
            </div>
            
            <div class="timer-display" id="timer-display" style="display: none;">
                <div class="stat-label">Time:</div>
                <div class="stat-value" id="timer-value">180</div>
            </div>
            
            <div class="goal-display">
                <div class="stat-label">Goal:</div>
                <div class="stat-value" id="goal-cards">3</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button id="menu-btn" class="btn btn-primary">Menu</button>
            <button id="reset-btn" class="btn btn-primary">Reset</button>
            <button id="pass-btn" class="btn btn-warning">Pass</button>
            <button id="go-btn" class="btn btn-success">GO!</button>
        </div>
    </div>

    <!-- Wild Cube Operator Selection Popover (moved outside #app to avoid scaling/positioning issues) -->
    <div id="wild-popover-backdrop" class="wild-popover-backdrop"></div>
    <div id="wild-popover" class="wild-popover">
        <!-- Buttons will be populated dynamically -->
    </div>

    <!-- Modals (moved outside #app to avoid scaling issues) -->
    
    <!-- Result Modal -->
    <div id="result-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="result-title"></h2>
            <div id="result-message"></div>
            <div id="result-score" class="result-score"></div>
            <button id="result-continue" class="btn btn-success">Continue</button>
        </div>
    </div>

    <!-- Menu Modal -->
    <div id="menu-modal" class="modal hidden">
        <div class="modal-content">
            <button id="menu-close-btn" class="modal-close-btn" aria-label="Close menu">√ó</button>
            <div id="menu-main-view">
                <h2>Menu</h2>
                <p class="menu-level-indicator">Currently on <strong>Level <span id="menu-current-level">1</span></strong></p>
                <ul class="menu-list">
                    <li><button id="menu-home-btn" class="btn btn-secondary">üè† Home</button></li>
                    <li><button id="tutorial-btn" class="btn btn-secondary">How to Play</button></li>
                    <li><button id="settings-btn" class="btn btn-primary">Settings</button></li>
                    <li><button id="puzzle-builder-btn" class="btn btn-primary">üõ†Ô∏è Puzzle Builder</button></li>
                    <li><button id="refresh-btn" class="btn btn-primary">üîÑ Refresh</button></li>
                </ul>
            </div>
            <div id="menu-settings-view" class="hidden">
                <h2>Settings</h2>
                <div class="settings-group">
                    <label class="setting-item">
                        <input type="checkbox" id="solution-helper-toggle" checked>
                        <span class="setting-label">
                            <strong>Solution Helper</strong>
                            <small id="solution-helper-description">Guided mode: automatically highlights cards that match your current solution.</small>
                        </span>
                    </label>
                </div>
                <div class="settings-group" style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px; margin-top: 15px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 1rem; color: rgba(255,255,255,0.9);">üîß Test Mode</h3>
                    <label class="setting-item">
                        <input type="checkbox" id="test-mode-toggle">
                        <span class="setting-label">
                            <strong>Easy Scores (50 points)</strong>
                            <small>Reduce all level requirements to 50 points for quick testing</small>
                        </span>
                    </label>
                    <label class="setting-item" style="margin-top: 10px;">
                        <span class="setting-label">
                            <strong>Jump to Level</strong>
                            <small>Skip to any level for testing</small>
                        </span>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <select id="level-selector" class="level-select">
                                <option value="1">Level 1</option>
                                <option value="2">Level 2</option>
                                <option value="3">Level 3</option>
                                <option value="4">Level 4</option>
                                <option value="5">Level 5</option>
                                <option value="6">Level 6</option>
                                <option value="7">Level 7</option>
                                <option value="8">Level 8</option>
                                <option value="9">Level 9</option>
                                <option value="10">Level 10</option>
                            </select>
                            <button id="jump-to-level-btn" class="btn btn-primary">Jump</button>
                        </div>
                    </label>
                </div>
                <div class="settings-group" style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px; margin-top: 15px;">
                    <label class="setting-item">
                        <span class="setting-label">
                            <strong>üóëÔ∏è Clear Game Data</strong>
                            <small>Reset all progress and start as a new player</small>
                        </span>
                    </label>
                    <button id="clear-data-btn" class="btn btn-danger" style="margin-top: 10px; width: 100%;">Clear All Data</button>
                </div>
                <button id="settings-back-btn" class="btn btn-secondary">Back</button>
            </div>

            <!-- Puzzle Builder View -->
            <div id="menu-builder-view" class="hidden">
                <h2>üõ†Ô∏è Puzzle Builder</h2>
                <p style="margin-bottom: 15px; opacity: 0.8; font-size: 14px;">
                    Create custom puzzles for testing or export as tutorial scenarios.
                </p>
                
                <!-- Card Selector -->
                <details class="builder-section" open>
                    <summary>1. Select 8 Cards <span class="builder-info" style="margin-left: 10px;">(<span id="selected-card-count">0</span> / 8)</span></summary>
                    <div class="builder-section-content">
                        <div id="card-palette" class="card-palette">
                            <!-- Will be populated dynamically with all 16 possible cards -->
                        </div>
                    </div>
                </details>
                
                <!-- Dice Selector -->
                <details class="builder-section">
                    <summary>2. Select Dice <span class="builder-info" style="margin-left: 10px;">(Colors: <span id="selected-color-count">0</span> / 4)</span></summary>
                    <div class="builder-section-content">
                        <div class="builder-subsection">
                            <strong>Colors (select 4):</strong>
                            <div id="color-selector" class="dice-selector">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                        <div class="builder-subsection">
                            <strong>Operators (select 2+):</strong>
                            <div id="operator-selector" class="dice-selector">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                        <div class="builder-subsection">
                            <strong>Special Flags:</strong>
                            <div id="special-flags" class="dice-selector">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </details>
                
                <!-- Goal Selector -->
                <details class="builder-section">
                    <summary>3. Set Goal</summary>
                    <div class="builder-section-content">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <label>Target number of cards:</label>
                            <select id="goal-selector" class="level-select">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                    </div>
                </details>
                
                <!-- Actions -->
                <details class="builder-section">
                    <summary>4. Actions</summary>
                    <div class="builder-section-content">
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button id="load-scenario-btn" class="btn btn-primary">üìã Load Scenario</button>
                            <button id="play-scenario-btn" class="btn btn-success">üéÆ Play This Scenario</button>
                            <button id="test-solution-btn" class="btn btn-success">üîç Check for Solutions</button>
                            <button id="export-json-btn" class="btn btn-secondary">üíæ Export as JSON</button>
                            <button id="save-scenario-btn" class="btn btn-secondary">üíæ Save to Browser</button>
                        </div>
                        <div id="test-results" class="builder-results hidden">
                            <!-- Test results will appear here -->
                        </div>
                    </div>
                </details>
                
                <button id="builder-back-btn" class="btn btn-secondary" style="margin-top: 15px;">Back</button>
            </div>
            </div>
        </div>
    </div>

    <!-- Pass Confirmation Modal -->
    <div id="pass-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="pass-title"></h2>
            <div id="pass-message"></div>
            <div id="pass-buttons">
                <button id="pass-continue" class="btn btn-warning">Pass</button>
                <button id="pass-cancel" class="btn btn-secondary">Resume</button>
            </div>
        </div>
    </div>

    <!-- Timeout Modal (Level 7+) -->
    <div id="timeout-modal" class="modal hidden">
        <div class="modal-content">
            <h2>‚è∞ Time's Up!</h2>
            <p>Time expired! Starting a new puzzle...</p>
            <button id="timeout-ok" class="btn btn-primary">OK</button>
        </div>
    </div>

    <!-- Tutorial Instruction (shown during tutorials, replaces status bar) -->
    <div id="tutorial-instruction" class="tutorial-instruction hidden">
        <div class="tutorial-step-badge" id="tutorial-step-badge">Step 1/8</div>
        <p id="tutorial-instruction-text">Instruction text goes here</p>
        <div class="tutorial-buttons">
            <button id="tutorial-skip-btn" class="tutorial-skip-btn">Skip Tutorial</button>
            <button id="tutorial-next-btn" class="tutorial-next-btn">Next</button>
        </div>
    </div>

    <!-- Level Interstitial Screen (Full-page, replaces game board) -->
    <div id="level-interstitial-screen" class="interstitial-screen hidden">
        <button id="interstitial-menu-btn" class="btn btn-primary overlay-menu-btn">Menu</button>
        <div class="interstitial-container">
            <div class="interstitial-badge">
                <div class="badge-circle">
                    <span class="badge-level" id="interstitial-level">2</span>
                </div>
                <div class="badge-label">LEVEL</div>
            </div>
            
            <h1 id="interstitial-title" class="interstitial-title">New Level</h1>
            
            <div class="interstitial-feature">
                <div class="feature-symbol" id="interstitial-symbol">‚à™</div>
                <div class="feature-description">
                    <strong id="interstitial-feature-name">New Feature</strong>
                    <p id="interstitial-feature-desc">Description</p>
                </div>
            </div>
            
            <div class="interstitial-content">
                <p id="interstitial-description" class="description-text">
                    Level description goes here.
                </p>
            </div>
            
            <div class="interstitial-actions">
                <button id="tutorial-accept-btn" class="btn btn-primary btn-large">
                    <span class="btn-icon">üéì</span>
                    Show Me How
                </button>
                <button id="tutorial-decline-btn" class="btn btn-secondary btn-large">
                    I'll Figure It Out
                </button>
            </div>
        </div>
    </div>

    <!-- Home Screen -->
    <div id="home-screen" class="home-screen hidden">
        <button id="home-menu-btn" class="btn btn-primary overlay-menu-btn">Menu</button>
        <div class="home-container">
            <h1 class="home-title hidden">Ready, Set!</h1>
            <p><img src="images/ReadySet-Logo.svg" alt="Ready, Set!" class="home-logo"></p>
            <p class="home-subtitle">A Set Theory Puzzle Game</p>
            
            <div class="home-buttons">
                <button id="home-continue-btn" class="btn btn-primary btn-large hidden">
                    Continue Level <span id="home-current-level">1</span>
                </button>
                <button id="home-new-game-btn" class="btn btn-primary btn-large">
                    New Game
                </button>
                <button id="home-how-to-play-btn" class="btn btn-secondary btn-large">
                    How to Play
                </button>
            </div>
        </div>
    </div>

        <!-- GSAP Animation Library -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
        
        <script type="module" src="js/main.js?v=3.20.1-tutorial-vocabulary"></script>
</body>
</html>

